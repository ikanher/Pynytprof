# FILE_FORMAT.md ── NYTProf v5.0 stream as written by **Pynytprof**
#
# Scope
# -----
# Generates the smallest profile that Perl’s `Devel::NYTProf::Reader`
# (v 5.0) will load.  Little-endian only.  Zlib compression will be added
# later; today the stream is **uncompressed**.
#
# ──────────────────────────────────────────────────────────────────────
# 1.  ASCII banner (human-readable, newline-terminated)
# ──────────────────────────────────────────────────────────────────────
#
# The file starts with free-text lines, all ending in `\n`.  Layout:
#
#     NYTProf <major> <minor>\n
#     #Perl profile database. Generated by Pynytprof on <RFC-2822 date>\n
#
# *Attribute* lines (start with `:`) follow, one per line:
#
#     :basetime=<epoch-seconds>\n
#     :application=<argv0 or -e>\n
#     :perl_version=<py_major.minor.patch>\n
#     :nv_size=<sizeof(double) bytes>\n
#     :clock_mod=cpu\n
#     :ticks_per_sec=10000000\n
#     :osname=<platform.system().lower()>\n
#     :hz=<os.sysconf("SC_CLK_TCK") or 100>\n
#
# *Option* lines (start with `!`) mirror NYTProf defaults; values are
# hard-coded for now and updated as features land:
#
#     !subs=1
#     !blocks=0
#     !leave=1
#     !expand=0
#     !trace=0
#     !use_db_sub=0
#     !compress=0
#     !clock=1
#     !stmts=1
#     !slowops=2
#     !findcaller=0
#     !forkdepth=-1
#     !perldb=0
#     !nameevals=1
#     !nameanonsubs=1
#     !calls=1
#     !evals=0
#
# The banner **always ends with a blank line** (`\n\n`).  The first byte
# after that blank line is the token for the first binary chunk.
#
# ──────────────────────────────────────────────────────────────────────
# 2.  Binary chunk stream
# ──────────────────────────────────────────────────────────────────────
#
# Each chunk is *tag-length-value*:
#
#     u8   token        (ASCII letter)  
#     u32  length_le    (payload size)  
#     ...  payload      (exactly *length* bytes)
#
# Current chunk types
# -------------------
#
# | Token | Payload struct                                                         | Notes                                                              |
# |-------|------------------------------------------------------------------------|--------------------------------------------------------------------|
# | `F`   | `{u32 fid,u32 flags,u32 size,u32 mtime,zstr path}` × N                 | Script = fid 0, `flags |= 0x10` (HAS_SRC)                           |
# | `S`   | `{u32 fid,u32 line,u32 calls,u64 inc_ticks,u64 exc_ticks}` × M         | One record per executed line; ticks in 100 ns units                 |
# | `D`   | `{u32 sid,u32 flags,zstr name}` × K                                    | Subroutine descriptors — flags = 0 for now                          |
# | `C`   | `{u32 caller_sid,u32 callee_sid,u32 calls,u64 ticks,u64 sub_ticks}` × L| Call-graph edges; `ticks=sub_ticks` until exclusive time added     |
# | `E`   | **empty**                                                              | Terminator                                                         |
#
# Tokens `H`, `B`, and `A` are **not** emitted when using the ASCII banner.
#
# ──────────────────────────────────────────────────────────────────────
# 3.  Tick units
# ──────────────────────────────────────────────────────────────────────
#
# One tick = 100 ns. `ticks_per_sec` is fixed at 10 000 000.  All tick
# arithmetic uses 64-bit integers.
#
# ──────────────────────────────────────────────────────────────────────
# 4.  Endianness
# ──────────────────────────────────────────────────────────────────────
#
# Entire stream is little-endian. NYTProf rejects big-endian files.
#
# ──────────────────────────────────────────────────────────────────────
# 5.  Version constants
# ──────────────────────────────────────────────────────────────────────
#
# Defined in `nytp_version.h` and used by both writers:
#
#     #define NYTPROF_MAJOR 5  
#     #define NYTPROF_MINOR 0
#
# Docs and code must be updated together if these change.
#
# ──────────────────────────────────────────────────────────────────────
# 6.  Reference dump
# ──────────────────────────────────────────────────────────────────────
#
# `vendor/NYTProf_refs/sample_nytprof.out.compressed.xxd-dump.txt` is 
# the golden dump taken on 2025-07-09.  A new profile’s first 64 bytes
# must match except for time-dependent fields 
# (`basetime`, date-string, etc.).
#
# `vendor/NYTProf_refs/sample_nytprof.out.uncompressed.xxd-dump.txt` is 
# the same profile, but in uncompressed format.
#
# --------------------------------------------------------------------
